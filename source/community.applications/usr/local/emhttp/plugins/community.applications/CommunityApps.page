Menu="Apps"
Icon="community.applications.png"
Title="Community Applications"
Tag="users"
---
<?
###############################################################
#                                                             #
# Community Applications copyright 2015-2019, Andrew Zawadzki #
#                    All Rights Reserved                      #
#                                                             #
###############################################################
$plugin = "community.applications";

require_once("/usr/local/emhttp/plugins/$plugin/include/paths.php");
require_once("/usr/local/emhttp/plugins/$plugin/include/helpers.php");

$cfg = parse_plugin_cfg($plugin);
if ( ! is_file($communityPaths['warningAccepted']) ) {
	$firstRun = "true";
}
$unRaidSettings = parse_ini_file($communityPaths['unRaidVersion']);
$unRaid66 = version_compare($unRaidSettings['version'],"6.5.3",">");

if ( is_file($communityPaths['addConverted']) ) {
	$dockerConvertFlag = "true";
}
?>
<link type='text/css' rel='stylesheet' href="<?=autov("/plugins/community.applications/skins/Narrow/css.php")?>" >
<link type='text/css' rel='stylesheet' href='<?=autov("/plugins/community.applications/styles/awesomplete.css")?>'>
<script src='<?autov("/plugins/community.applications/javascript/libraries.js")?>'></script>
<script>
var URL = "/plugins/<?=$plugin?>/include/exec.php";
var last = $('input[name$="tabs"]').length;
var searchBoxInput;
var searchBoxAwesomplete;
var pluginInstallIntervalTimer;

var data = new Object();
data.docker = "";
data.section = "AppStore";
data.selected_category = "";
data.subcategory = "";
data.selected_subcategory = "";
data.selected = "";
data.lastUpdated = 0;
data.nextpage = 0;
data.prevpage = 0;
data.currentpage = 1;
var dockerSearchFlag = false;

$(function(){
	caPluginUpdateCheck("community.applications.plg",{debug:true,noDismiss:true,name:"Community Applications"},function(data) {
		if (data) {
			var result = JSON.parse(data);
			$("#caInstalledVersion").html(result.installedVersion);
		}
	});
	
	$("#title").append('<div id="Category" class="categoryLine ca_italic"></div>');
	$("#title").append("<div class='searchArea'><span id='sortIconArea' style='display:none;'><i class='sortIcons fa fa-sort-alpha-asc enabledIcon ca_staticTips' title='Sort By Name' data-sort='nameUp'></i><i class='sortIcons fa fa-sort-alpha-desc ca_staticTips' title='Sort By Name' data-sort='nameDown'></i><i class='sortIcons fa fa-sort-numeric-desc ca_staticTips' title='Sort By Downloads' data-sort='downloadsDown'></i><i class='sortIcons fa fa-sort-numeric-asc ca_staticTips' title='Sort By Downloads' data-sort='downloadsUp'></i><i class='sortIcons fa fa-sort-amount-desc ca_staticTips' title='Sort By Trend' data-sort='trendDown'></i><i class='sortIcons fa fa-sort-amount-asc ca_staticTips' title='Sort By Trend' data-sort='trendUp'></i></span><i id='sortIcon' class='fa fa-sort ca_toolsView disabledIcon' aria-hidden='true'></i>&nbsp;<span id='searchFilter' class='status' style='margin-top:-1rem;'><input type='text' id='searchBox' placeholder='Search' autofocus><button class='searchSubmit' style='margin-right:10px' onclick='doSearch(true)'><i id='searchButton' class='fa fa-search fa-lg'></i></button></div>");

	searchBoxInput = document.getElementById("searchBox");
	searchBoxAwesomplete = new Awesomplete(searchBoxInput);

	if ( ! cookiesEnabled() ) {
		addWarning("Community Applications works best when cookies are enabled in your browser.  Certain features may not be available.");
	}

	if ( isTouch() ) {
		$("#templates_content").on("swipeleft",swipelefthandler);
		function swipelefthandler(event) {
			if ( $(".pageNavigation").length ) {
				if ( data.nextpage > 1 ) {
					if ( dockerSearchFlag ) {
						dockerSearch(data.nextpage);
					} else {
						changePage(data.nextpage);
					}
				}
			}
		}
		$("#templates_content").on("swiperight",swiperighthandler);
		function swiperighthandler(event) {
			if ( $(".pageNavigation").length ) {
				if ( data.prevpage > 0 ) {
					if ( dockerSearchFlag ) {
						dockerSearch(data.prevpage);
					} else {
						changePage(data.prevpage);
					}
				}
			}
		}
	}

	$('.ca_toolsView').tooltipster({
		trigger: 'hover',
		delay: [1000,0],
		animation: 'fade',
		triggerClose: {mouseleave:true},
		functionBefore: function(instance,helper){
			if ( isIconEnabled("#sortIcon") ) {
				instance.content("Sorting options");
			} else {
				instance.content("Sorting options unavailable");
			}
		}
	});

	$('.categoryMenu').on("click",function() {
		var selectedCategory = $(this).attr("data-category");
		changeCategory(this,false);
	});

	$("#searchBox").keydown(function(e) {
		if (e.which === 13) {
			doSearch();
		}
	});
	
	$(".initDockerSearch").click(function()     { initDockerSearch(); });
	$(".multi_installButton").click(function()  { installMulti(); });
	$(".multi_installClear").click(function()   { clearMultiInstall(); });
	$(".startupButton").click(function()        { updateContent(this); });
	initilizeMenu();
	$("#sortIcon").click(function() {
		if ( isIconEnabled("#sortIcon") ) {
			$("#sortIconArea").toggle("slow");
		}
	});
	$(".sortIcons").click(function() {
		enableSortIcon(this);
		changeSortOrder();
		$("#sortIconArea").toggle("slow");
	});

<?if ( ! $unRaid66 ):?>
	$("html").css("font-size","10px");
<?endif;?>
	
	/* Everything is now initialized.  This is the start of the actual "real" code */
	if ( "<?=$firstRun?>" == "true" ) {
		sweetAlertBackground("white");
		swal({
			title: 'Disclaimer',
			text: 'All applications listed here are <span class="ca_bold">3rd party</span> additions to unRaid.  Neither the authors of Community Applications nor Limetech make any warranty as to the suitability of any application listed here. <br><span class="ca_italic"><font color="green">Every attempt is made to ensure that only safe and compatible applications are present</font></span><font size=0><br>Note: if your flash drive is corrupted you may also see this message and it will need to be fixed first</font>',
			html: true,
			type: 'error',
			footer: "test",
			showCancelButton: true,
			showConfirmButton: true,
			confirmButtonText: 'I Understand'
		}, function (isConfirm) {
			if ( isConfirm ) {
				$.post(URL,{action:'dismiss_warning'},function(data) {
					if (data) {
						location.reload();
					}
				});
			} else {
				addWarning("Installations of apps disabled.  You must accept the warning to be able to install applications.  Click <a onclick='window.location.reload();' style='cursor:pointer;'>HERE</a>");
				updateContent();
			}
		});
	} else {
		if ( (document.referrer.indexOf("/Apps/") > 1) && ( document.referrer.indexOf("/Apps/ca_settings") < 1 ) && cookiesEnabled() && ("<?=$dockerConvertFlag?>" != "true") ) {
			populateAutoComplete();
			restoreState();
			refreshDisplay();
		} else {
			updateContent();
		}
	}
});

function disableSort() {
	hideSortIcons();
	enableIcon("#sortIcon",false);
}

function hideSortIcons() {
	$("#sortIconArea").hide("slow");
}

function initilizeMenu() {
	$(".caMenuItem").on("mouseover",function() {
		$(this).addClass("hoverMenu");
	});
	$(".caMenuItem").on("mouseleave",function() {
		$(this).removeClass("hoverMenu");
	});
	$(".caMenuItem").on("click",function() {
		if ( $(this).hasClass("selectedMenu") ) {
			return;
		}

		if ( ! $(this).parent().hasClass("subCategory") ) {
			$(".subCategory").hide();
		}
		$(".caMenuItem").each(function() {
			$(this).removeClass("selectedMenu");
		});
		$(this).addClass("selectedMenu");
		$(this).next().show();
	});
}

function updateContent(button) {
	hideSortIcons();
	clearSearchBox();
	$("#Category").html("");
	$(".caMenuItem").each(function() {
		$(this).removeClass("selectedMenu");
	});
	$(".subCategory").each(function() {
		$(this).hide();
	});
	startupScreen = $.cookie("startupButton") ? $.cookie("startupButton") : "onlynew";
	$(".caMenuItem[data-category='"+startupScreen+"']").addClass("selectedMenu")

	var appFeedModeMsg = button ? "" : "Retrieving the latest application Lists";

	startupScreen = button ? $(button).data("category") : startupScreen;
	$.cookie("startupButton",startupScreen,{expires:365});
	$.cookie("selectedMenu",startupScreen,{expires:365});
	disableSearch();
	mySpinner();
	if ( appFeedModeMsg ) {
		myAlert("Updating Content",appFeedModeMsg,true,"40");
	}
	$.post(URL,{action:'force_update'}, function(data) {
		if (data) {
			if ( $.cookie("plugininstallpending" || ! appFeedModeMsg ) ) {
				var plugins = $.cookie("plugininstallpending");
				$.removeCookie("plugininstallpending");
				myCloseAlert();
				openBox('/plugins/<?=$plugin?>/scripts/installMultiPlugin.sh&arg1='+plugins,'Install Plugin Applications',600,900,true);
			} else {
				if ( myTrim(data) != "ok" ) {
					updateDisplay(data);
				} else {
					getContent(true,'INITIALIZE',"","",startupScreen);
				}
			}
		}
	});
}

function enableSortIcon(icon) {
	$(".sortIcons").each(function() {
		$(this).removeClass("enabledIcon");
	});
	$(icon).addClass("enabledIcon");
}

function enableIcon(icon,enable) {
	enable = (enable == "false") ? false : enable;
	$(icon).each(function() {
		$(this).removeClass("enabledIcon disabledIcon");
		var newClass = enable ? "enabledIcon" : "disabledIcon";
		$(this).addClass(newClass);
	});
}

function isIconEnabled(icon) {
	return $(icon).hasClass("enabledIcon");
}

function stripTags(string) {
	return string.replace(/(<([^>]+)>)/ig,"");
}

function setToolTip() {
	$('.ca_multiselect').click( function() {
		enableMultiInstall();
	});

	$('.ca_tooltip,.ca_staticTips').tooltipster({
		contentAsHTML:true,
		delay:[1000,1],
		timer:15000,
		animation:'none',
		arrow:true,
		trigger:'custom',
		triggerOpen:{mouseenter: true},
		triggerClose:{click:true,scroll:true,mouseleave:true}
	});
	$('.ca_tooltip-warning').tooltipster({
		contentAsHTML:true,
		interactive:true,
		trigger:'custom',
		triggerOpen:{click: true},
		triggerClose:{click:true,scroll:true,mouseleave:true}
	});
	$('.ca_appPopup').click(function() {
		var appnumber = $(this).data("appnumber");
		var apppath = $(this).data("apppath");
		var appname = $(this).data("appname");
		appname = stripTags(appname);
		showDesc_openBox("/plugins/community.applications/scripts/showDesc.php?appNumber="+appnumber+"&appPath="+apppath+"&appName="+appname+"'",appname,450,650,true,"checkForPluginInstallRequested()");
	});
	myCloseAlert();
}

// Wait for the showDesc modal to close before opening another to install plugin
function checkForPluginInstallRequested() {
	var pluginURL = $.cookie("installPluginURL");
	if ( pluginURL ) {
		pluginInstallIntervalTimer = setInterval(modalPluginInstall,100);
	}
}

function modalPluginInstall() {
	if ( ! $("#sb-container").is(":visible") ) {
		clearInterval(pluginInstallIntervalTimer);
		var pluginURL = $.cookie("installPluginURL");
		$.removeCookie("installPluginURL");
		installPlugin(pluginURL);
	}
}

function showSpecialCategory(button) {
	$(".caMenuItem").removeClass("selectedMenu");
	$(".multi_installDiv").hide();
	data.selected_category = "DOESNTMATTERWHATSHERE";
	data.section = "AppStore";
	changeCategory(button,false);
}

function changeCategory(button,subSwitch) {
	var description = $(button).text();
	var category = $(button).attr("data-category");
	clearSearchBox();
	hideSortIcons();
	clearCategory();
	$(".multi_installDiv").hide();
	scrollToTop();
	getContent(false,category,description,false);
}

function changePage(pageNumber) {
	if ( data.currentpage < pageNumber ) {
		var directionOut = "Left";
		var directionIn = "Right";
	} else {
		var directionOut = "Right";
		var directionIn = "Left";
	}
	var sortOrder = getSortOrder();
	var selected = data.selected;
	data.currentpage = pageNumber;

	animateCSS(".ca_templatesDisplay","fadeOut"+directionOut,function() {
		$(".ca_templatesDisplay").html("");
		hideSortIcons();
   	$.post(URL,{action:'display_content',sortOrder:sortOrder,pageNumber:pageNumber,selected:selected},function(data3) {
			if (data3) {
				updateDisplay(data3,directionIn);
			}
		});
	});
}

function animateCSS(element, animationName, callback) {
	const node = document.querySelector(element)
	node.classList.add('animated', animationName,'fastest')

	function handleAnimationEnd() {
		node.classList.remove('animated', animationName)
		node.removeEventListener('animationend', handleAnimationEnd)

		if (typeof callback === 'function') callback()
	}
	node.addEventListener('animationend', handleAnimationEnd)
}

function myAlert(description,textdescription,textimage,imagesize, outsideClick, showCancel, showConfirm, alertType) {
	if ( !outsideClick ) outsideClick = false;
	if ( !showCancel )   showCancel = false;
	if ( !showConfirm )  showConfirm = false;
	if ( imagesize == "" ) { imagesize = "80"; }
	disableSearch();
	var backgroundColor = ( ! textdescription && textimage ) ? "transparent" : "white";

	swal({
		title: description,
		text: textdescription,
		allowOutsideClick: outsideClick,
		showConfirmButton: showConfirm,
		showCancelButton: showCancel,
		type: alertType,
		animation: false,
		html: true
	});
	sweetAlertBackground(backgroundColor);
}

function myCloseAlert() {
	swal.close();
	enableSearch();
	$("div.spinner").hide();
}

function mySpinner() {
	$("div.spinner").show();
}

function sweetAlertBackground(color) {
	$(".sweet-alert").css("background",color);
}

function doSearch(button,newSearch) {
	searchBoxAwesomplete.close();
	hideSortIcons();

	if ( ! newSearch === false ) {
		$('#searchBox').val(newSearch);
	}
	var filter = $('#searchBox').val();
	if ( button && ! filter) {
		$("#searchBox").attr("placeholder","Please enter search term");
		return;
	} else {
		$("#searchBox").attr("placeholder","Search");
	}
	data.docker = "";
	data.section = "AppStore";
	filter = filter.replace(/[^a-z0-9]/gi,' ')
	filter = myTrim(filter);
	$('#searchBox').val(filter);
	$(".multi_installDiv").hide();

	if ($('#searchButton').hasClass('fa-search')) {
		if (filter) {
			$('#searchButton').toggleClass('fa-search fa-remove');
		}
	} else if (button) {
		clearSearchBox();
		filter = '';
	} else {
		if (!filter) {
			return;
		}
	}

	if (filter) {
		$("#Category").html("Search for "+filter);
		enableIcon("#sortIcon",true);
	}

	scrollToTop();
	if ( !filter ) {
		updateContent();
		return;
	}
	var sortOrder = getSortOrder();
	if ( "<?=$cfg['dockerSearch']?>" == "yes" ) {
		$('.dockerSearch').show();
	}
	mySpinner();

	$.post(URL,{action:'get_content',filter:filter,sortOrder:sortOrder},function(data) {
		if (data) {
			enableButtons();
			updateDisplay(data);
			data.section = "AppStore";
			$(".selectedMenu").removeClass("selectedMenu");
		}
	});
}

function forceUpdate() {
	$("#Category").html("");
	clearSearchBox();
	$.post(URL,{action:'force_update'},function(data){
		if (data) {
			getContent(true,'INITIALIZE','None Selected');
		}
	});
}

function enableButtons() {
	data.selected_category = "";
}

function refreshDisplay() {
	changeSortOrder(null,null,null);
}

function changeSortOrder(button,buttonClass,previousApps) {
	var pageNumber = data.currentpage;
	var selected = data.selected;
	var sortOrder = getSortOrder();
	var startup = false;
	if ( button != null || buttonClass != null || previousApps != null ) {
		mySpinner();
	}
	$(".startupButton").each(function(){
		if ($(this).hasClass("selectedMenu")) {
			startup = "true";
		}
	});
	$.post(URL,{action:'display_content',sortOrder:sortOrder,pageNumber:pageNumber,selected:selected,startup:startup},function(data3) {
		if (data3) {
			updateDisplay(data3);
		}
	});
}

function getSortOrder() {
	var sortOrder = new Object();

	$(".sortIcons").each(function() {
		if ( isIconEnabled(this) ) {
			switch ( $(this).data("sort") ) {
				case 'nameUp':
					sortOrder.sortBy = ["sortBy","Name"];
					sortOrder.sortDir = ["sortDir","Up"];
					break;
				case 'nameDown':
					sortOrder.sortBy = ["sortBy","Name"];
					sortOrder.sortDir = ["sortDir","Down"];
					break;
				case 'downloadsDown':
					sortOrder.sortBy = ["sortBy","downloads"];
					sortOrder.sortDir = ["sortDir","Down"];
					break;
				case 'downloadsUp':
					sortOrder.sortBy = ["sortBy","downloads"];
					sortOrder.sortDir = ["sortDir","Up"];
					break;
				case 'trendDown':
					sortOrder.sortBy = ["sortBy","trending"];
					sortOrder.sortDir = ["sortDir","Down"];
					break;
				case 'trendUp':
					sortOrder.sortBy = ["sortBy","trending"];
					sortOrder.sortDir = ["sortDir","Up"];
					break;
			}
		}
	});
	return [sortOrder.sortBy,sortOrder.sortDir];
}

function getContent(init,category,description,newApp,startupDisplay) {
	data.currentpage = 1;
	var initialize;

	enableSearch();
	if ( init == true ) {
		enableIcon("#sortIcon",false);
	} else {
		enableIcon("#sortIcon",true);
		mySpinner();
	}

	if ( category != "NONE" ) {
		if ( category == "INITIALIZE" ) {
			initializeAppStore();
			category = "NONE";
			initialize = true;
			enableButtons();
		}
		if ( (category == "New") || (category == "All") ) { category = ""; }

		var sortOrder = getSortOrder();

		$.post(URL,{action:'get_content',category:category,newApp:newApp,sortOrder:sortOrder,startupDisplay:startupDisplay},function(data) {
			if (data) {
				updateDisplay(data);

				if ( initialize ) {
					populateAutoComplete();
				}
			}
		});
	}
	$('.dockerSearch').hide();
}

function populateAutoComplete() {
	$.post(URL,{action:'populateAutoComplete'},function(data) {
		if (data) {
			$("#awesomepleteScript").html(data);
			searchBoxAwesomplete.maxItems = 20;
			Awesomplete.$('#searchBox').removeEventListener('awesomplete-selectcomplete',awesompleteSearch)
			Awesomplete.$('#searchBox').addEventListener('awesomplete-selectcomplete',awesompleteSearch)
		}
	});
}
function awesompleteSearch() {
	doSearch(false);
}

function mySearch(filter) {
	filter = filter.replace(/<(?:.|\n)*?>/gm, '');
	$('#searchBox').val(filter);

	if ( $("#searchButton").hasClass('fa-search') ) {
		$('#searchButton').toggleClass('fa-search fa-remove');
	}
	initDockerSearch(1);
}

function initDockerSearch() {
	dockerSearch(1);
	data.docker = "searching docker";
	data.section = "";
	data.selected_category = "";
	$(".selectedMenu").removeClass("selectedMenu");
	hideSortIcons();
	$(".subCategory").hide(300);
}

function dockerSearch(pageNumber) {
	if ( data.prevpage < pageNumber ) {
		var directionOut = "Left";
		var directionIn = "Right";
	} else {
		var directionOut = "Right";
		var directionIn = "Left";
	}
	var filter = $('#searchBox').val();
	var dockerURL = "https://registry.hub.docker.com/search?q=" + filter;
	data.docker = "searching docker";
	enableIcon("#sortIcon",false);
	$(".dockerSearch,.multi_installDiv").hide();
	$("#Category").html("DockerHub Search for "+filter+" <span id='pageNumber'></span>");
	var sortOrder = getSortOrder();
	mySpinner();
	animateCSS(".ca_templatesDisplay","fadeOut"+directionOut,function() {
		$("#templates_content").html("");
		$.post(URL,{action:'search_dockerhub',filter:filter,page:pageNumber,sortOrder:sortOrder},function(data) {
			if (data) {
				updateDisplay(data,directionIn);
			}
		});
	});
}

function dockerConvert(dockerID) {
	mySpinner();
	$.post(URL,{action:'convert_docker',ID:dockerID},function(data) {
		if (data) {
			myCloseAlert();
			templateURL = "/Apps/AddContainer?xmlTemplate=default:" + myTrim(data);
			window.open(templateURL,"_self");
		}
	});
}

function clearSearchBox() {
	$("#searchBox").val("");
	if ($('#searchButton').hasClass('fa-remove')) {
		$('#searchButton').toggleClass('fa-remove fa-search');
	}
}

function installPlugin(pluginURL) {
	disableSearch();
	my_openBox('/plugins/community.applications/scripts/pluginInstall.sh&arg1=install&arg2='+pluginURL,'Install Plugin',600,900,true,"refreshDisplay()");
}

function my_openBox(cmd,title,height,width,load,func) {
	// open shadowbox window (run in foreground)
	var run = cmd.split('?')[0].substr(-4)=='.php' ? cmd : '/logging.htm?cmd='+cmd+'&csrf_token=<?=$var['csrf_token']?>';
	var options = load ? {modal:true,onClose:function(){ eval(func); }} : {modal:true};
	Shadowbox.open({content:run, player:'iframe', title:title, height:height, width:width, options:options});
}
function showDesc_openBox(cmd,title,height,width,load,func) {
	// open shadowbox window (run in foreground)
	var run = cmd.split('?')[0].substr(-4)=='.php' ? cmd : '/logging.htm?cmd='+cmd+'&csrf_token=<?=$var['csrf_token']?>';
	var options = load ? {modal:false,onClose:function(){ eval(func); }} : {modal:true};
	Shadowbox.open({content:run, player:'iframe', title:title, height:height, width:width, options:options});
}

function showModeration(script,title) {
	$("#sb-nav-close").css("visisbility","visible");
	showDesc_openBox("/plugins/<?=$plugin?>/scripts/showStatistics.php?arg1="+script,title,550,900,true,false);
}

function previousApps(button,installed) {
	hideSortIcons();
	clearCategory();
	setPageOne();
	data.docker = "";

	clearSearchBox();
	$(".dockerSearch").hide();
	enableIcon("#sortIcon",true);

	$.post(URL,{action:'previous_apps',installed:installed},function(data) {
		if (data) {
			if ( installed ) {
				$(".multi_installDiv").hide();
			} else {
				$(".multi_installDiv").show();
				clearMultiInstall();
			}
			changeSortOrder(null,null,"true");
			saveState();
		}
	});
}

function removeApp(application, humanName) {
	sweetAlertBackground("white");
	disableSearch();
	swal({
		title: "Delete Template?",
		text: "Are you sure you want to delete <font color='red'><strong><span class='ca_italic'>"+humanName+"</span></strong></font> from the list of previously installed applications?<br><font size='0'>"+application+"</font>",
		type: "warning",
		confirmButtonText: "Yes, delete it!",
		showCancelButton: true,
		showConfirmButton: true,
		allowOutsideClick: true,
		html: true
	}, function(isConfirm) {
		if (isConfirm) {
			$.post(URL,{action:'remove_application',application:application}, function(data) {
				if (data) {
					enableSearch();
					previousApps("OldApps",false);
				}
			});
		} else {
			enableSearch();
		}
	 });
}

function uninstallApp(application,humanName) {
	if ( humanName == "Community Applications" ) {
		myAlert("AE-35 Error","<span class='ca_italic'>I'm sorry Dave, but I can't do that</span>.  You must go to the plugins tab and remove Community Applications from there.  <span class='ca_italic'><font color='purple'>But, why would you ever want to uninstall CA?</font></span>",null,null,true,false,true,"error");
	} else {
		sweetAlertBackground("white");
		disableSearch();
		swal({
			title: "Uninstall Application?",
			text: "Are you sure you want to uninstall <font color='red'><strong><span class='ca_italic'>"+humanName+"</span></strong></font>?",
			type: "warning",
			showCancelButton: true,
			showConfirmButton: true,
			confirmButtonText: "Yes, uninstall it!",
			closeOnConfirm: false,
			showLoaderOnConfirm: true,
			allowOutsideClick: true,
			html: true
		}, function(isConfirm) {
			if (isConfirm) {
				myAlert("","Uninstalling "+humanName);
				$.post(URL,{action:'uninstall_application',application:application}, function(data) {
					if (data) {
						previousApps("InstalledApps",true);
						enableSearch();
					}
				});
			} else {
				enableSearch();
			}
		});
	}
}

function deletePrivateApp(path,name,author) {
	var displayPath = path.replace("/boot/config/plugins/","...");
	sweetAlertBackground("white");
	disableSearch();
	swal({
		title: "Remove Private Application?",
		text: "Are you sure you want to remove the private application <span class='ca_italic'><font color='red'><span class='ca_bold'>"+name+"</span></font> by <font color='red'><span class='ca_bold'>"+author+"</span></font>?<br><font size='0'>("+displayPath+")",
		type: "warning",
			showCancelButton: true,
			showConfirmButton: true,
			confirmButtonText: "Yes, remove it!",
			closeOnConfirm: false,
			showLoaderOnConfirm: true,
			allowOutsideClick: true,
			html: true
	}, function(isConfirm) {
		if ( isConfirm ) {
			swal("Removing "+name,"","info");
			getSelectedApps();
			$.post(URL,{action:'removePrivateApp',path:path},function(data) {
				if (data) {
					myCloseAlert();
					refreshDisplay();
					enableSearch();
				}
			});
		} else {
			enableSearch();
		}
	});
}

function myTrim(x) {
	return x.replace(/^\s+|\s+$/gm,'');
}

function uninstallDocker(application,humanName) {
	sweetAlertBackground("white");
	disableSearch();
	swal({
		title: "Uninstall Application?",
		text: "Are you sure you want to uninstall <font color='red'><strong><span class='ca_italic'>"+humanName+"</span></strong></font>?",
		type: "warning",
		showCancelButton: true,
		showConfirmButton: true,
		confirmButtonText: "Yes, uninstall it!",
		closeOnConfirm: false,
		showLoaderOnConfirm: true,
		allowOutsideClick: true,
		html: true
	}, function( isConfirm ) {
		if ( isConfirm ) {
			myAlert("","Uninstalling "+humanName);
			$.post(URL,{action:'uninstall_docker',application:application},function(data) {
				if (data) {
					enableSearch();
					previousApps("InstalledApps",true);
				}
			});
		} else {
			enableSearch();
		}
	});
}

function appStore() {
	mySpinner();
	data.nextpage = 0;
	data.prevpage = 0;
	initializeAppStore();
	updateContent();
	$("#Category").html("");
	data.docker = "";
}

function initializeAppStore() {
	data.section = "AppStore";
	data.selected_category = "";
	$(".multi_installDiv").hide();
}
function installPLGupdate(filename,plgName) {
	$("#sortorder").attr("data-plgfilename",filename);
	if ( filename == "community.applications.plg" ) {
		openBox('/plugins/<?=$plugin?>/scripts/updatePLG.sh&arg1='+filename,'Update '+plgName,600,900,true);
	} else {
		my_openBox('/plugins/<?=$plugin?>/scripts/updatePLG.sh&arg1='+filename,'Update '+plgName,600,900,true,"checkPLGupdate()");
	}
}
function checkPLGupdate() {
	var filename = $("#sortorder").attr("data-plgfilename");
	$.post(URL,{action:'updatePLGstatus',filename:filename},function(data) {
		if (data) {
			var pageNumber = data.currentpage;
			changePage(pageNumber);
		}
	});
}

function pinApp(button,repository) {
	$(button).toggleClass("pinned unpinned");
	var pinned = ( $(button).hasClass("unpinned") ) ? "Click to pin this application" : "Click to unpin this application";
	$(button).tooltipster('content',pinned);
	$.post(URL,{action:'pinApp',repository:repository});
}

function setPageOne() {
	data.currentpage = 1;
}

function clearCategory() {
	$("#Category").html("");
}
function pinnedApps(button) {
	mySpinner();
	setPageOne();
	hideSortIcons();
	data.docker = "";
	clearSearchBox();
	clearCategory();
	$(".dockerSearch,.multi_installDiv").hide();
	enableIcon("#sortIcon",true);
	$.post(URL,{action:'pinnedApps'},function(data) {
		if (data) {
			refreshDisplay();
			myCloseAlert();
		}
	});
}

function displayTags(leadTemplate) {
	$.post(URL,{action:'displayTags',leadTemplate:leadTemplate},function(data) {
		if (data) {
			sweetAlertBackground("white");
			disableSearch();
			swal({
				title: "Choose A Branch To Install",
				text: data,
				html: true,
				type: "warning",
				showCancelButton: true,
				showConfirmButton: false,
				allowOutsideClick: true
			}, function(isConfirm) {
				if ( ! isConfirm ) {
					enableSearch();
				}
			});
		}
	});
}

function makePlural(string,count) {
	return ( (count > 1) || (count == 0) ) ? string + "s" : string;
}

function getSelectedApps() {
	if ( data.selected ) {
		var selected = JSON.parse(data.selected);
		var docker = selected.docker;
		var plugin = selected.plugin;
	} else {
		var selected = new Object();
		var docker = new Array();
		var plugin = new Array();
	}

	$(".ca_multiselect").each(function() {
		var name = $(this).attr("data-name");
		if ( $(this).is(':checked') ) {
			if ( $(this).attr("data-type") == "plugin" ) {
				plugin.push(name);
			} else {
				docker.push(name);
			}
		} else {
			var index = plugin.indexOf(name);
			if ( index > -1 ) {
				plugin.splice(index,1);
			}
			var index = docker.indexOf(name);
			if (index > -1 ) {
				docker.splice(index,1);
			}
		}
	});
	selected.docker = uniqueArrayElements(docker);
	selected.plugin = uniqueArrayElements(plugin);
	data.selected = JSON.stringify(selected);
	return selected;
}

function uniqueArrayElements(sourceArray) {
	var uniqueEntries = new Array();
	$.each(sourceArray, function(i, el) {
		if ($.inArray(el,uniqueEntries) === -1) {
			uniqueEntries.push(el)
		}
	});
	return uniqueEntries;
}

function enableMultiInstall() {
	var selected = getSelectedApps();
	if ( $.isEmptyObject(selected.docker) && $.isEmptyObject(selected.plugin) ) {
		$(".multi_install,.multi_installClear").attr("disabled",true);
		$(".multi_installButton").val("Install Selected Applications");
	} else {
		$(".multi_install,.multi_installClear").attr("disabled",false);
		var count = selected.plugin.length + selected.docker.length;
		$(".multi_installButton").val("Install "+(selected.plugin.length+selected.docker.length)+" Selected "+makePlural("Application",count));
	}
	getSelectedApps();
}

function clearMultiInstall() {
	data.selected = "";
	$(".ca_multiselect").each(function() {
		$(this).prop("checked",false);
	});
	$(".multi_install,.multi_installClear").attr("disabled",true);
	enableMultiInstall();
}

function installMulti() {
	var docker = new Array();
	var plugin = "";
	var pluginCount = 0;
	var dockerCount = 0;
	var selected = getSelectedApps();
	var cookieWarning = "";

	$.each(selected.plugin,function(i,el) {
		plugin += el + "*";
		pluginCount += 1;
	});
	$.each(selected.docker,function(i,el) {
		docker.push(el);
		dockerCount += 1;
	});
	sweetAlertBackground("white");
	disableSearch();
	if ( ! cookiesEnabled() && dockerCount && pluginCount ) {
		pluginCount = 0;
		cookieWarning = "<br>Cookies not enabled.  Plugins must be separately installed from docker applications";
	}
	if ( (dockerCount + pluginCount) > 1 ) {
		var buttonText = "Yes, install them";
	} else {
		var buttonText = "Yes, install it";
	}
	swal({
		title: "Install "+makePlural("Application",dockerCount+pluginCount)+"?",
		text: "Are you sure you want to install "+dockerCount+" docker "+makePlural("application",dockerCount)+" and "+pluginCount+" "+makePlural("plugin",pluginCount)+"?  <span class='ca_italic'>Docker applications will be installed utilizing the most recently saved template with no user input on your part</span><font color='red'>"+cookieWarning+"</font>",
		type: "info",
		showCancelButton: true,
		showConfirmButton: true,
		confirmButtonText: buttonText,
		closeOnConfirm: false,
		showLoaderOnConfirm: true,
		allowOutsideClick: true,
		html: true
	}, function( isConfirm ) {
		if ( isConfirm ) {
			myCloseAlert();
			if ( docker.length && plugin.length ) {
				$.cookie("plugininstallpending",plugin);
			}
			if ( docker.length ) {
				$("#sb-nav-close").css("visibility","hidden"); // Because docker install cannot be aborted so why allow window to close
				openBox('/plugins/<?=$plugin?>/scripts/installMulti.php?plugin='+plugin+'&docker='+docker,'Install Docker '+makePlural("Application",dockerCount),600,1100,true);
			} else {
				openBox('/plugins/<?=$plugin?>/scripts/installMultiPlugin.sh&arg1='+plugin,'Install Plugin '+makePlural("Application",pluginCount),600,900,true);
				enableSearch();
			}
		} else {
			enableSearch();
		}
	});
}

function updateDisplay(data,direction="") {
	if ( direction == "" ) {
		animateCSS(getAnimateClass(),"fadeOutLeft",function() {
			$("#templates_content").html(data);
			handle_HTTP_icons();
			animateCSS(getAnimateClass(),"fadeInRight",function() {
				afterUpdateDisplay();
			});
		});
	} else {
		$("#templates_content").html(data);
		handle_HTTP_icons();
		animateCSS(getAnimateClass(),"fadeIn"+direction,function() {
			afterUpdateDisplay();
		});
	}
}

function getAnimateClass() {
	if ( $(".ca_templatesDisplay").length ) {
		return ".ca_templatesDisplay";
	} else {
		return "#templates_content";
	}
}

function afterUpdateDisplay() {
	setToolTip();
	enableSearch();
	saveState();
}

function handle_HTTP_icons() {
	$('img').on("error",function() {
		var origSource = $(this).attr('src');
		if ( document.referrer.startsWith("https") && "<?=$cfg['secureImage']?>" == "secure" ) {
			$(this).attr('src',"https://github.com/Squidly271/community.applications/raw/master/webImages/no_https.png");
		} else {
			var newSource = origSource.replace("https://","http://");
			$(this).attr('src',newSource);
			$(this).on("error",function() {
				$(this).attr('src',"/plugins/dynamix.docker.manager/images/question.png");
			});
		}
	});
}

function saveState() {
	if ( ! dockerSearchFlag ) {
		$.cookie("categoryText",$("#Category").html());
		$.cookie("data",JSON.stringify(data));
		$.cookie("dockerSearchFlag",dockerSearchFlag);
		$.cookie("installMulti",$(".multi_installDiv").is(":visible"));
		var selectedMenu = $(".selectedMenu").data("category");
		if ( ! selectedMenu ) {
			selectedMenu = "";
		}
		$.cookie("selectedMenu",selectedMenu);
		$.cookie("sortIcon",isIconEnabled("#sortIcon"));

		$(".sortIcons").each(function() {
			if ( isIconEnabled(this) ) {
				$.cookie("sortButton",$(this).data("sort"));
			}
		});
	}
}

function restoreState() {
	$("#Category").html($.cookie("categoryText"));
	if ( $.cookie("installMulti") == "true" ) {
		$(".multi_installDiv").show();
	} else {
		$(".multi_installDiv").hide();
	}
	data = JSON.parse($.cookie("data"));
	dockerSearchFlag = $.cookie("dockerSearchFlag");
	var selectedMenu = $.cookie("selectedMenu");
	if ( selectedMenu ) {
		var menuItem = $.find(".caMenuItem[data-category='"+selectedMenu+"']");
		$(".caMenuItem").each(function(){
			$(this).removeClass("selectedMenu");
		});
		$(menuItem).addClass("selectedMenu");
		$(menuItem).parent().show();
	}
	enableIcon("#sortIcon",$.cookie("sortIcon"));
	$(".sortIcons").each(function() {
		$(this).removeClass("enabledIcon");
	});
	var selectedSort = $.cookie("sortButton");
	var sortIcon = $.find(".sortIcons[data-sort='"+selectedSort+"']");
	$(sortIcon).addClass("enabledIcon");

	if ( $("#Category").text() == "Category: None Selected" ) {
		updateContent();
	}
}

function disableSearch() {
	$("#searchBox").prop("disabled",true);
}

function enableSearch() {
	$("#searchBox").prop("disabled",false);
}

function evaluateBoolean(str) {
	regex=/^\s*(true|1|on)\s*$/i
	return regex.test(str);
}

function cookiesEnabled() {
	return evaluateBoolean(navigator.cookieEnabled);
}

function isTouch() {
<?if ( $cfg['mobileAllowed'] == "true" ):?>
	try{ document.createEvent("TouchEvent"); return true; }
	catch(e){ return false; }
<?else:?>
	return false;
<?endif;?>
}

function showCredits() {
	$(".multi_installDiv,.dockerSearch").hide();
	clearCategory();
	$.post(URL,{action:'showCredits'},function(data) {
		if (data) {
			updateDisplay(data);
		}
	});
}

function showStatistics() {
	$(".multi_installDiv,.dockerSearch").hide();
	clearCategory();
	updateDisplay("");
	$.post(URL,{action:'statistics'},function(data) {
		if (data) {
			updateDisplay(data);
		}
	});
}

function caChangeLog() {
	$.post(URL,{action:'caChangeLog'},function(data) {
		if (data) {
			updateDisplay(data);
		}
	});
}

function scrollToTop() {
  $('html,body').animate({scrollTop:0},500);
}

function addWarning(text) {
	var existingWarning = $('.caWarning').html();
	if ( existingWarning.indexOf(text) < 1 ) {
		$('.caWarning').append("&bull; "+text+"<br>");
	}
	$('.caNotice').show();
}

</script>

> <i class='fa fa-sort enabledIcon' aria-hidden='true' style='font-size:2rem;'></i> - This chooses how to display the results<br><br>
> <i class='fa fa-download' aria-hidden='true' style='font-size:2rem;'></i> <i class='fa fa-edit' aria-hidden='true' style='font-size:2rem;'></i> - These icons respectively will <span class='ca_bold'>Install or Edit</span> an application<br>
> <i class='fa fa-globe' aria-hidden='true' style='font-size:2rem;'></i> <i class='fa fa-cog' aria-hidden='true' style='font-size:2rem;'></i> - Clicking these icons will take you to an application's GUI or settings<br>
> <i class='fa fa-window-close' aria-hidden='true' style='font-size:2rem;color:maroon;'></i> - Clicking this icon will uninstall the application or delete it from the lists depending upon your current section<br>
> <span class='unpinned'> </span><span class='pinned'></span> Clicking these icons will pin / unpin an application for later viewer (from the Pinned Apps section)<br>
> <i class='fa fa-info-circle' aria-hidden='true' style='font-size:2rem;'></i> Clicking this will display more information about the application<br>
> <i class='fa fa-exclamation-triangle' aria-hidden='true' style='font-size:2rem;'></i> Clicking this will display any warnings or extra comments about the application<br>
> <center>For support for this plugin, visit <a title='click for help' href="https://lime-technology.com/forums/topic/38582-plug-in-community-applications/" target="_blank">HERE</a></center>
> <center><a href='https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&hosted_button_id=7M7CBCVU732XG' target='_blank'><img src="https://www.paypalobjects.com/en_US/i/btn/btn_donateCC_LG.gif"></a></center>
<div class='notice caNotice'>
	<span class='caWarning'></span>
</div>
<div class='menuItems'>
<div class='menuHeader'>MENU</div>
<ul class='caMenu'>
	<li class='caMenuItem' onclick='previousApps(this.id,true);' data-category='installed_apps'>Installed Apps</li>
	<li class='caMenuItem' onclick='previousApps(this.id,false);' data-category='previous_apps'>Previous Apps</li>
	<li class='caMenuItem' onclick='pinnedApps(this.id);' data-category='pinned_apps'>Pinned Apps</li>
</ul>
<div class='menuHeader'>CATEGORIES</div>
<ul class='caMenu'>
	<li class='startupButton caMenuItem' data-category='onlynew'>New Apps</li>
	<li class='startupButton caMenuItem' data-category='new'>Updated Apps</li>
	<li class='startupButton caMenuItem' data-category='random'>Random Apps</li>
	<li class='startupButton caMenuItem' data-category='trending'>Trending Apps</li>
</ul>
<hr>
<ul class='caMenu'>
	<li class='categoryMenu caMenuItem' data-category='backup'>Backup</li>
	<li class='categoryMenu caMenuItem' data-category='cloud'>Cloud</li>
	<li class='categoryMenu caMenuItem' data-category='downloaders'>Downloaders</li>
	<li class='categoryMenu caMenuItem' data-category='HomeAutomation'>Home Automation</li>
	<li class='categoryMenu caMenuItem' data-category='network'>Network Services</li>
	<ul class='subCategory'>
		<li class='categoryMenu caMenuItem' data-category='Network:web'>Web&nbsp;Server</li>
		<li class='categoryMenu caMenuItem' data-category='Network:DNS'>DNS</li>
		<li class='categoryMenu caMenuItem' data-category='Network:FTP'>FTP</li>
		<li class='categoryMenu caMenuItem' data-category='Network:proxy'>Proxy</li>
		<li class='categoryMenu caMenuItem' data-category='Network:VOIP'>VOIP</li>
		<li class='categoryMenu caMenuItem' data-category='Network:Management'>Management</li>
		<li class='categoryMenu caMenuItem' data-category='Network:Messenger'>Messenger</li>
		<li class='categoryMenu caMenuItem' data-category='Network:Other'>Other</li>
	</ul>
	<li class='categoryMenu caMenuItem' data-category='mediaapp'>Media Applications</li>
	<ul class='subCategory'>
		<li class='categoryMenu caMenuItem' data-category='MediaApp:Video'>Video</li>
		<li class='categoryMenu caMenuItem' data-category='MediaApp:Music'>Music</li>
		<li class='categoryMenu caMenuItem' data-category='MediaApp:Books'>Books</li>
		<li class='categoryMenu caMenuItem' data-category='MediaApp:Photos'>Photos</li>
		<li class='categoryMenu caMenuItem' data-category='MediaApp:Other'>Other</li>
	</ul>
	<li class='categoryMenu caMenuItem' data-category='mediaserver'>Media Servers</li>
	<ul class='subCategory'>
		<li class='categoryMenu caMenuItem' data-category='MediaServer:Video'>Video</li>
		<li class='categoryMenu caMenuItem' data-category='MediaServer:Music'>Music</li>
		<li class='categoryMenu caMenuItem' data-category='MediaServer:Books'>Books</li>
		<li class='categoryMenu caMenuItem' data-category='MediaServer:Photos'>Photos</li>
		<li class='categoryMenu caMenuItem' data-category='MediaServer:Other'>Other</li>
	</ul>
	<li class='categoryMenu caMenuItem' data-category='productivity'>Productivity</li>
	<li class='categoryMenu caMenuItem' data-category='tools'>Tools / Utilities</li>
	<ul class='subCategory'>
		<li class='categoryMenu caMenuItem' data-category='Tools:system'>System</li>
	</ul>
	<li class='categoryMenu caMenuItem' data-category='other'>Other</li>
	<li class='categoryMenu caMenuItem' data-category='plugins'>Plugins</li>
	<li class='categoryMenu caMenuItem' data-category='All'>All Apps</li>
</ul>
<div class='menuHeader'>OTHER</div>
<ul class='caMenu'>
	<li class='caMenuItem' onclick='window.location="/Apps/ca_settings"'>Settings</a></li>
	<li class='caMenuItem' onclick='disableSort();scrollToTop();showStatistics();'>Statistics</li>
	<li class='caMenuItem' onclick='disableSort();scrollToTop();showCredits();'>Credits</li>
	<li class='caMenuItem'><a class='caMenuItem' href='https://forums.unraid.net/topic/38582-plug-in-community-applications/' target='_blank' style='text-decoration:none;color:inherit;'>Support</a></li>
	</ul>
<div class='menuHeader'>VERSION</div>
<ul class='nonselectMenu'>
	<li><span id='caInstalledVersion'></span></li>
	<li class='caMenuItem' style='cursor:pointer;' onclick='disableSort();scrollToTop();caChangeLog();'>Change Log</li>
</ul>
 <br><br><br>
</div>
<br>
</span><br>
<div class='mainArea'>
<div class='multi_installDiv'><div class='ca_center'><input class='multi_install multi_installButton' type='button' value='Install Selected Applications' disabled><input type='button' class='multi_installClear' value='Clear Selected' disabled></div></div>
<strong><font size='3'></strong></font>
<div class='dockerSearch' style='display:none'><div class='ca_center'><i class='fa fa-docker initDockerSearch' style='font-size:5rem;color:DarkCyan;cursor:pointer;'></i><br><a class='initDockerSearch' style='cursor:pointer;'>Click Here To Get More Results From DockerHub</a></div></div>
<div id='templates_content'><div class='ca_templatesDisplay'></div></div>
<div class='multi_installDiv'><div class='ca_center'><input class='multi_install multi_installButton' type='button' value='Install Selected Applications' disabled><input type='button' class='multi_installClear' value='Clear Selected' disabled></div></div>
</div>
</div>
<span id='miscScript'></span><span id='awesomepleteScript'></span>
<span id='sortorder' data-sortorder='' data-selected=''></span>
<span id='debugging'></span>
<div class='spinner fixed'></div>
